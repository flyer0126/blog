---
layout: post
comments: true
categories: php
---

## PHP浮点数精度损失问题

`
<?php
$a = 0.57;
echo intval(floatval($a) * 100); //56
`
结果可能有点出乎你的意外，PHP遵循IEEE 754双精度：
  浮点数, 以64位的双精度, 采用1位符号位(E), 11指数位(Q), 52位尾数(M)表示(一共64位)
  符号位：最高位表示数据的正负，0表示正数，1表示负数。
  指数位：表示数据以2为底的幂，指数采用偏移码表示
  尾数：表示数据小数点后的有效数字.

再来看看小数用二进制怎么表示：
  乘2取整，顺序排列，即将小数部分乘以2，然后取整数部分，剩下的小数部分继续乘以2，然后取整数部分，剩下的小数部分又乘以2，一直取到小数部分，但是像0.57这样的小数像这样一直乘下去，小数部分不可能为0.有效位的小数用二进制表示却是无穷的。
  0.57的二进制表示基本上(52位)是: 0010001111010111000010100011110101110000101000111101
  如果只有52位的话，0.57 =》 0.56999999999999995
  对于高精度数据操作，建议使用以下函数：
  bcadd — 将两个高精度数字相加
  bccomp — 比较两个高精度数字，返回-1, 0, 1
  bcdiv — 将两个高精度数字相除
  bcmod — 求高精度数字余数
  bcmul — 将两个高精度数字相乘
  bcpow — 求高精度数字乘方
  bcpowmod — 求高精度数字乘方求模，数论里非常常用
  bcscale — 配置默认小数点位数，相当于就是Linux bc中的”scale=”
  bcsqrt — 求高精度数字平方根
  bcsub — 将两个高精度数字相减